const mongoose = require('mongoose')
require('dotenv').config()

console.log('üå± Starting comprehensive database seeding...')

async function connectDB() {
  try {
    const uri = process.env.MONGODB_URI || 'mongodb://localhost:27017/military-logistics'
    await mongoose.connect(uri)
    console.log('‚úÖ Connected to MongoDB')
    return true
  } catch (error) {
    console.error('‚ùå MongoDB connection error:', error)
    return false
  }
}

// Define all schemas inline for seeding
const userSchema = new mongoose.Schema({
  name: String,
  email: String,
  password: String,
  role: String,
  rank: String,
  position: String,
  contact: String,
  isActive: { type: Boolean, default: true }
}, { timestamps: true })

const unitSchema = new mongoose.Schema({
  name: String,
  code: String,
  personnel: Number,
  commander: String,
  contact: String,
  description: String,
  isActive: { type: Boolean, default: true }
}, { timestamps: true })

const lttpItemSchema = new mongoose.Schema({
  name: String,
  category: String,
  unit: String,
  unitPrice: Number,
  description: String,
  nutritionalInfo: {
    calories: { type: Number, default: 0 },
    protein: { type: Number, default: 0 },
    fat: { type: Number, default: 0 },
    carbs: { type: Number, default: 0 },
    fiber: { type: Number, default: 0 },
  },
  storageRequirements: {
    temperature: String,
    humidity: String,
    shelfLife: Number,
  },
  supplier: {
    name: String,
    contact: String,
    address: String
  },
  isActive: { type: Boolean, default: true },
  createdBy: { type: mongoose.Schema.Types.ObjectId, ref: 'User' }
}, { timestamps: true })

// Create models
const User = mongoose.model('User', userSchema)
const Unit = mongoose.model('Unit', unitSchema)
const LTTPItem = mongoose.model('LTTPItem', lttpItemSchema)

// Comprehensive data
const usersData = [
  {
    name: "Thi·∫øu t√° Nguy·ªÖn VƒÉn Admin",
    email: "admin@military.gov.vn",
    password: "$2b$10$kQZc5yFqVhHjGGhRtqTNEODMGwqOPkzJjJ5wKpFhNVxYtQwER7uNK", // admin123
    role: "admin",
    rank: "Thi·∫øu t√°",
    position: "Tr∆∞·ªüng ph√≤ng Qu·∫£n l√Ω T√†i kho·∫£n",
    contact: "0901111111"
  },
  {
    name: "ƒê·∫°i √∫y Tr·∫ßn Th·ªã Manager",
    email: "manager@military.gov.vn",
    password: "$2b$10$kQZc5yFqVhHjGGhRtqTNEODMGwqOPkzJjJ5wKpFhNVxYtQwER7uNK", // admin123
    role: "stationManager",
    rank: "ƒê·∫°i √∫y",
    position: "Qu·∫£n l√Ω Tr·∫°m ch·∫ø bi·∫øn",
    contact: "0902222222"
  },
  {
    name: "Trung √∫y L√™ VƒÉn User",
    email: "user@military.gov.vn",
    password: "$2b$10$kQZc5yFqVhHjGGhRtqTNEODMGwqOPkzJjJ5wKpFhNVxYtQwER7uNK", // admin123
    role: "user",
    rank: "Trung √∫y",
    position: "C√°n b·ªô Qu·∫£n l√Ω Kho",
    contact: "0903333333"
  }
]

const unitsData = [
  {
    name: "Th·ª© ƒëo√†n 1",
    code: "TD1",
    personnel: 150,
    commander: "ƒê·∫°i √∫y Nguy·ªÖn VƒÉn A",
    contact: "0901234567",
    description: "ƒê∆°n v·ªã ch·ªß l·ª±c s·ªë 1"
  },
  {
    name: "Th·ª© ƒëo√†n 2",
    code: "TD2", 
    personnel: 135,
    commander: "ƒê·∫°i √∫y Tr·∫ßn VƒÉn B",
    contact: "0901234568",
    description: "ƒê∆°n v·ªã ch·ªß l·ª±c s·ªë 2"
  },
  {
    name: "Th·ª© ƒëo√†n 3",
    code: "TD3",
    personnel: 140,
    commander: "ƒê·∫°i √∫y L√™ VƒÉn C",
    contact: "0901234569", 
    description: "ƒê∆°n v·ªã ch·ªß l·ª±c s·ªë 3"
  },
  {
    name: "L·ªÖ ƒëo√†n h·ªô",
    code: "LDH",
    personnel: 45,
    commander: "Thi·∫øu √∫y Ph·∫°m VƒÉn D",
    contact: "0901234570",
    description: "ƒê∆°n v·ªã h·ªó tr·ª£ v√† l·ªÖ t√¢n"
  }
]

const lttpItemsData = [
  // Th·ª±c ph·∫©m ch√≠nh
  {
    name: "G·∫°o t·∫ª lo·∫°i 1",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 22000,
    description: "G·∫°o t·∫ª ch·∫•t l∆∞·ª£ng cao, d√†nh cho n·∫•u c∆°m h√†ng ng√†y",
    nutritionalInfo: { calories: 365, protein: 7.1, fat: 0.7, carbs: 80.9, fiber: 0.4 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 365 },
    supplier: { name: "C√¥ng ty TNHH L∆∞∆°ng th·ª±c Mi·ªÅn Nam", contact: "0909123456", address: "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM" }
  },
  {
    name: "G·∫°o n√†ng h∆∞∆°ng",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 28000,
    description: "G·∫°o n√†ng h∆∞∆°ng th∆°m d·∫ªo",
    nutritionalInfo: { calories: 368, protein: 7.0, fat: 0.8, carbs: 81.2, fiber: 0.5 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 365 }
  },
  {
    name: "Th·ªãt heo n·∫°c",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg", 
    unitPrice: 180000,
    description: "Th·ªãt heo n·∫°c t∆∞∆°i, ƒë·∫°t ti√™u chu·∫©n v·ªá sinh an to√†n th·ª±c ph·∫©m",
    nutritionalInfo: { calories: 143, protein: 20.9, fat: 6.4, carbs: 0, fiber: 0 },
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 3 },
    supplier: { name: "C√¥ng ty CP ChƒÉn nu√¥i Vi·ªát Nam", contact: "0908765432", address: "456 ƒê∆∞·ªùng XYZ, Qu·∫≠n 2, TP.HCM" }
  },
  {
    name: "Th·ªãt heo ba ch·ªâ",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 160000,
    description: "Th·ªãt heo ba ch·ªâ t∆∞∆°i",
    nutritionalInfo: { calories: 263, protein: 17.8, fat: 20.8, carbs: 0, fiber: 0 },
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 3 }
  },
  {
    name: "Th·ªãt b√≤ n·∫°c",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 280000,
    description: "Th·ªãt b√≤ n·∫°c t∆∞∆°i, ch·∫•t l∆∞·ª£ng cao",
    nutritionalInfo: { calories: 135, protein: 26.1, fat: 2.6, carbs: 0, fiber: 0 },
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 3 }
  },
  {
    name: "Th·ªãt g√† ta",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 120000,
    description: "Th·ªãt g√† ta t∆∞∆°i, th·ªãt ch·∫Øc ngon",
    nutritionalInfo: { calories: 165, protein: 31.0, fat: 3.6, carbs: 0, fiber: 0 },
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 3 }
  },
  {
    name: "C√° tra fillet",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 85000,
    description: "C√° tra fillet t∆∞∆°i, kh√¥ng ch·∫•t b·∫£o qu·∫£n",
    nutritionalInfo: { calories: 90, protein: 15.0, fat: 2.5, carbs: 0, fiber: 0 },
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 2 }
  },
  {
    name: "C√° basa fillet",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 75000,
    description: "C√° basa fillet t∆∞∆°i",
    nutritionalInfo: { calories: 97, protein: 16.2, fat: 3.0, carbs: 0, fiber: 0 },
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 2 }
  },
  {
    name: "T√¥m s√∫",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 320000,
    description: "T√¥m s√∫ t∆∞∆°i, size l·ªõn",
    nutritionalInfo: { calories: 106, protein: 20.3, fat: 1.7, carbs: 0.9, fiber: 0 },
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 1 }
  },
  {
    name: "Tr·ª©ng g√† t∆∞∆°i",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 35000,
    description: "Tr·ª©ng g√† t∆∞∆°i, size 2-3",
    nutritionalInfo: { calories: 155, protein: 13.0, fat: 11.0, carbs: 1.1, fiber: 0 },
    storageRequirements: { temperature: "M√°t", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 14 }
  },
  
  // Rau c·ªß qu·∫£
  {
    name: "C√† chua",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 25000,
    description: "C√† chua t∆∞∆°i, m√†u ƒë·ªè ch√≠n",
    nutritionalInfo: { calories: 18, protein: 0.9, fat: 0.2, carbs: 3.9, fiber: 1.2 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 7 }
  },
  {
    name: "Rau c·∫£i ng·ªçt",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 18000,
    description: "Rau c·∫£i ng·ªçt t∆∞∆°i, xanh non",
    nutritionalInfo: { calories: 13, protein: 1.5, fat: 0.2, carbs: 2.2, fiber: 1.2 },
    storageRequirements: { temperature: "M√°t", humidity: "·∫®m", shelfLife: 3 }
  },
  {
    name: "Rau mu·ªëng",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 15000,
    description: "Rau mu·ªëng t∆∞∆°i",
    nutritionalInfo: { calories: 19, protein: 2.6, fat: 0.2, carbs: 3.1, fiber: 2.1 },
    storageRequirements: { temperature: "M√°t", humidity: "·∫®m", shelfLife: 2 }
  },
  {
    name: "B·∫Øp c·∫£i",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 12000,
    description: "B·∫Øp c·∫£i t∆∞∆°i, l√° xanh ƒë·∫≠m",
    nutritionalInfo: { calories: 25, protein: 1.3, fat: 0.1, carbs: 5.8, fiber: 2.5 },
    storageRequirements: { temperature: "M√°t", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 14 }
  },
  {
    name: "C·ªß c·∫£i tr·∫Øng",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 15000,
    description: "C·ªß c·∫£i tr·∫Øng t∆∞∆°i, to ƒë·ªÅu",
    nutritionalInfo: { calories: 18, protein: 0.6, fat: 0.1, carbs: 4.1, fiber: 1.6 },
    storageRequirements: { temperature: "M√°t", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 14 }
  },
  {
    name: "C√† r·ªët",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 20000,
    description: "C√† r·ªët t∆∞∆°i, m√†u cam ƒë·∫πp",
    nutritionalInfo: { calories: 41, protein: 0.9, fat: 0.2, carbs: 9.6, fiber: 2.8 },
    storageRequirements: { temperature: "M√°t", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 21 }
  },
  {
    name: "Khoai t√¢y",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 20000,
    description: "Khoai t√¢y t∆∞∆°i, v·ªè s·∫°ch",
    nutritionalInfo: { calories: 77, protein: 2.0, fat: 0.1, carbs: 17.6, fiber: 2.2 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 30 }
  },
  {
    name: "Khoai lang",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 18000,
    description: "Khoai lang t∆∞∆°i",
    nutritionalInfo: { calories: 86, protein: 1.6, fat: 0.1, carbs: 20.1, fiber: 3.0 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 21 }
  },
  {
    name: "H√†nh l√°",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 45000,
    description: "H√†nh l√° t∆∞∆°i, th∆°m",
    nutritionalInfo: { calories: 32, protein: 1.8, fat: 0.2, carbs: 7.3, fiber: 2.6 },
    storageRequirements: { temperature: "M√°t", humidity: "·∫®m", shelfLife: 5 }
  },
  {
    name: "H√†nh t√≠m",
    category: "Rau c·ªß qu·∫£",
    unit: "Kg",
    unitPrice: 35000,
    description: "H√†nh t√≠m t∆∞∆°i",
    nutritionalInfo: { calories: 40, protein: 1.1, fat: 0.1, carbs: 9.3, fiber: 1.7 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 30 }
  },
  
  // Gia v·ªã
  {
    name: "Mu·ªëi tinh",
    category: "Gia v·ªã",
    unit: "Kg",
    unitPrice: 8000,
    description: "Mu·ªëi tinh khi·∫øt, kh√¥ng iod",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 1095 }
  },
  {
    name: "ƒê∆∞·ªùng c√°t tr·∫Øng",
    category: "Gia v·ªã",
    unit: "Kg",
    unitPrice: 22000,
    description: "ƒê∆∞·ªùng c√°t tr·∫Øng tinh khi·∫øt",
    nutritionalInfo: { calories: 387, protein: 0, fat: 0, carbs: 99.8, fiber: 0 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 730 }
  },
  {
    name: "N∆∞·ªõc m·∫Øm",
    category: "Gia v·ªã",
    unit: "L√≠t",
    unitPrice: 35000,
    description: "N∆∞·ªõc m·∫Øm truy·ªÅn th·ªëng ƒë·ªô ƒë·∫°m 30",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 1095 }
  },
  {
    name: "T∆∞∆°ng ·ªõt",
    category: "Gia v·ªã",
    unit: "Chai",
    unitPrice: 25000,
    description: "T∆∞∆°ng ·ªõt cay v·ª´a",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 365 }
  },
  {
    name: "D·∫ßu ƒÉn",
    category: "Gia v·ªã",
    unit: "L√≠t",
    unitPrice: 48000,
    description: "D·∫ßu ƒÉn th·ª±c v·∫≠t cao c·∫•p",
    nutritionalInfo: { calories: 884, protein: 0, fat: 100, carbs: 0, fiber: 0 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 540 }
  },
  {
    name: "T·ªèi t∆∞∆°i",
    category: "Gia v·ªã",
    unit: "Kg",
    unitPrice: 55000,
    description: "T·ªèi t∆∞∆°i, m√∫i to ƒë·ªÅu",
    nutritionalInfo: { calories: 149, protein: 6.4, fat: 0.5, carbs: 33.1, fiber: 2.1 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 60 }
  },
  {
    name: "G·ª´ng t∆∞∆°i",
    category: "Gia v·ªã",
    unit: "Kg",
    unitPrice: 45000,
    description: "G·ª´ng t∆∞∆°i, cay n·ªìng",
    nutritionalInfo: { calories: 80, protein: 1.8, fat: 0.8, carbs: 17.8, fiber: 2.0 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 30 }
  },
  {
    name: "H·∫°t ti√™u",
    category: "Gia v·ªã",
    unit: "Kg",
    unitPrice: 280000,
    description: "H·∫°t ti√™u ƒëen nguy√™n ch·∫•t",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 1095 }
  },
  {
    name: "B·ªôt ng·ªçt",
    category: "Gia v·ªã",
    unit: "Kg",
    unitPrice: 45000,
    description: "B·ªôt ng·ªçt tinh khi·∫øt",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 730 }
  },
  {
    name: "X√¨ d·∫ßu",
    category: "Gia v·ªã",
    unit: "L√≠t",
    unitPrice: 32000,
    description: "X√¨ d·∫ßu ƒë·∫≠m ƒë√†",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 730 }
  },
  
  // Nguy√™n li·ªáu ch·∫ø bi·∫øn
  {
    name: "ƒê·∫≠u n√†nh kh√¥",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 28000,
    description: "ƒê·∫≠u n√†nh kh√¥ ch·∫•t l∆∞·ª£ng cao ƒë·ªÉ l√†m ƒë·∫≠u ph·ª• v√† gi√° ƒë·ªó",
    nutritionalInfo: { calories: 446, protein: 36.5, fat: 19.9, carbs: 30.2, fiber: 9.3 },
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 365 }
  },
  {
    name: "Th·∫°ch cao th·ª±c ph·∫©m",
    category: "Gia v·ªã",
    unit: "Kg",
    unitPrice: 45000,
    description: "Th·∫°ch cao th·ª±c ph·∫©m d√πng l√†m ƒë·∫≠u ph·ª•",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 1095 }
  },
  {
    name: "Ru·ªôt l·ª£n",
    category: "Th·ª±c ph·∫©m",
    unit: "Kg",
    unitPrice: 85000,
    description: "Ru·ªôt l·ª£n t∆∞∆°i d√πng l√†m v·ªè x√∫c x√≠ch",
    storageRequirements: { temperature: "L·∫°nh", humidity: "B√¨nh th∆∞·ªùng", shelfLife: 1 }
  },
  
  // Ch·∫•t ƒë·ªët
  {
    name: "Gas LPG",
    category: "Ch·∫•t ƒë·ªët",
    unit: "Kg",
    unitPrice: 28000,
    description: "Gas n·∫•u ƒÉn LPG ti√™u chu·∫©n",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 1095 }
  },
  {
    name: "Than c·ªßi",
    category: "Ch·∫•t ƒë·ªët",
    unit: "Kg",
    unitPrice: 15000,
    description: "Than c·ªßi kh√¥, ch√°y l√¢u",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 365 }
  },
  
  // D·ª•ng c·ª•
  {
    name: "Dao inox",
    category: "D·ª•ng c·ª•",
    unit: "C√°i",
    unitPrice: 85000,
    description: "Dao inox s·∫Øc b√©n, ch·ªëng g·ªâ",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 1825 }
  },
  {
    name: "Th·ªõt g·ªó",
    category: "D·ª•ng c·ª•",
    unit: "C√°i",
    unitPrice: 120000,
    description: "Th·ªõt g·ªó t·ª± nhi√™n, d√†y d·∫∑n",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 1095 }
  },
  {
    name: "N·ªìi inox",
    category: "D·ª•ng c·ª•",
    unit: "C√°i",
    unitPrice: 450000,
    description: "N·ªìi inox 3 ƒë√°y, dung t√≠ch 20L",
    storageRequirements: { temperature: "Th∆∞·ªùng", humidity: "Kh√¥", shelfLife: 3650 }
  }
]

async function clearAllData() {
  const collections = ['users', 'units', 'lttpitems', 'lttpinventories', 'lttpdistributions', 
                     'tofuprocessings', 'saltprocessings', 'beansproutsprocessings', 
                     'sausageprocessings', 'livestockprocessings', 'poultryprocessings']
  
  for (const collection of collections) {
    try {
      await mongoose.connection.db.collection(collection).drop()
      console.log(`üóëÔ∏è  Dropped ${collection}`)
    } catch (error) {
      // Collection might not exist
    }
  }
}

async function seedData() {
  try {
    console.log('üìã Seeding core data...')
    
    // Seed users
    const users = await User.insertMany(usersData)
    console.log(`üë• Created ${users.length} users`)
    
    // Seed units
    const units = await Unit.insertMany(unitsData)
    console.log(`üè¢ Created ${units.length} units`)
    
    // Seed LTTP items
    const itemsWithUser = lttpItemsData.map(item => ({
      ...item,
      createdBy: users[0]._id // Admin user
    }))
    
    const lttpItems = await LTTPItem.insertMany(itemsWithUser)
    console.log(`üì¶ Created ${lttpItems.length} LTTP items`)
    
    return { users, units, lttpItems }
  } catch (error) {
    console.error('‚ùå Error seeding core data:', error)
    throw error
  }
}

async function createProcessingData(users) {
  try {
    console.log('üè≠ Creating processing station data...')
    
    const ProcessingStationSchema = new mongoose.Schema({}, { strict: false })
    
    const TofuProcessing = mongoose.model('TofuProcessing', ProcessingStationSchema)
    const SaltProcessing = mongoose.model('SaltProcessing', ProcessingStationSchema)
    const BeanSproutsProcessing = mongoose.model('BeanSproutsProcessing', ProcessingStationSchema)
    const SausageProcessing = mongoose.model('SausageProcessing', ProcessingStationSchema)
    const LivestockProcessing = mongoose.model('LivestockProcessing', ProcessingStationSchema)
    const PoultryProcessing = mongoose.model('PoultryProcessing', ProcessingStationSchema)
    
    const today = new Date()
    const adminUserId = users[0]._id
    
    // Generate 60 days of data for each station
    const tofuData = []
    const saltData = []
    const beanSproutsData = []
    const sausageData = []
    const livestockData = []
    const poultryData = []
    
    for (let i = 59; i >= 0; i--) {
      const date = new Date(today)
      date.setDate(date.getDate() - i)
      
      // Tofu processing
      const soybeansInput = 30 + Math.floor(Math.random() * 40)
      const tofuOutput = Math.floor(soybeansInput * (0.25 + Math.random() * 0.1))
      
      tofuData.push({
        date: date,
        input: {
          soybeans: {
            quantity: soybeansInput,
            quality: 'T·ªët',
            price: 28000,
            carryOverFromPreviousDay: i === 59 ? 0 : Math.floor(Math.random() * 10)
          },
          water: soybeansInput * 8,
          coagulant: soybeansInput * 20
        },
        output: {
          tofu: {
            quantity: tofuOutput,
            quality: 'T·ªët',
            pricePerKg: 35000
          },
          whey: soybeansInput * 6,
          waste: Math.floor(soybeansInput * 0.1)
        },
        remaining: {
          soybeans: Math.floor(Math.random() * 15),
          tofu: Math.floor(Math.random() * 8)
        },
        financial: {
          totalInputCost: soybeansInput * 28000,
          totalOutputValue: tofuOutput * 35000,
          profit: (tofuOutput * 35000) - (soybeansInput * 28000),
          profitMargin: ((tofuOutput * 35000) - (soybeansInput * 28000)) / (soybeansInput * 28000) * 100
        },
        processing: {
          duration: 180 + Math.floor(Math.random() * 120),
          temperature: 80 + Math.floor(Math.random() * 15),
          yield: (tofuOutput / soybeansInput) * 100,
          qualityNotes: "ƒê·∫≠u ph·ª• ƒë·∫°t ch·∫•t l∆∞·ª£ng t·ªët"
        },
        processedBy: adminUserId,
        supervisedBy: adminUserId,
        notes: `S·∫£n xu·∫•t ƒë·∫≠u ph·ª• ng√†y ${date.toLocaleDateString('vi-VN')}`
      })
      
      // Salt processing
      const cabbageInput = 20 + Math.floor(Math.random() * 30)
      const pickledOutput = Math.floor(cabbageInput * (0.65 + Math.random() * 0.15))
      
      saltData.push({
        date: date,
        input: {
          cabbage: {
            quantity: cabbageInput,
            quality: 'T·ªët',
            price: 12000,
            carryOverFromPreviousDay: i === 59 ? 0 : Math.floor(Math.random() * 8)
          },
          salt: Math.floor(cabbageInput * 0.03),
          spices: [
            { name: "T·ªèi", quantity: 0.5, unit: "Kg" },
            { name: "·ªöt", quantity: 0.3, unit: "Kg" }
          ]
        },
        output: {
          pickledCabbage: {
            quantity: pickledOutput,
            quality: 'T·ªët',
            pricePerKg: 15000
          },
          brine: Math.floor(cabbageInput * 0.2),
          waste: Math.floor(cabbageInput * 0.05)
        },
        remaining: {
          cabbage: Math.floor(Math.random() * 10),
          pickledCabbage: Math.floor(Math.random() * 6)
        },
        financial: {
          totalInputCost: cabbageInput * 12000,
          totalOutputValue: pickledOutput * 15000,
          profit: (pickledOutput * 15000) - (cabbageInput * 12000),
          profitMargin: ((pickledOutput * 15000) - (cabbageInput * 12000)) / (cabbageInput * 12000) * 100
        },
        processing: {
          saltingTime: 24,
          fermentationTime: 48 + Math.floor(Math.random() * 48),
          yield: (pickledOutput / cabbageInput) * 100,
          qualityNotes: "Rau c·∫£i mu·ªëi ƒë·∫°t ƒë·ªô chua v·ª´a ph·∫£i"
        },
        processedBy: adminUserId,
        supervisedBy: adminUserId,
        notes: `∆Ø·ªõp mu·ªëi rau c·∫£i ng√†y ${date.toLocaleDateString('vi-VN')}`
      })
      
      // Add other processing stations...
      // Bean Sprouts, Sausage, Livestock, Poultry (similar structure)
    }
    
    // Insert all processing data
    await TofuProcessing.insertMany(tofuData)
    console.log(`ü•õ Created ${tofuData.length} tofu processing records`)
    
    await SaltProcessing.insertMany(saltData)
    console.log(`üßÇ Created ${saltData.length} salt processing records`)
    
    console.log('‚úÖ Processing station data created successfully')
    
  } catch (error) {
    console.error('‚ùå Error creating processing data:', error)
    throw error
  }
}

async function createDatabase() {
  let connected = false
  
  try {
    connected = await connectDB()
    if (!connected) {
      throw new Error('Could not connect to database')
    }
    
    console.log('üóëÔ∏è  Clearing existing data...')
    await clearAllData()
    
    console.log('üìã Seeding core data...')
    const { users, units, lttpItems } = await seedData()
    
    console.log('üè≠ Creating processing station data...')
    await createProcessingData(users)
    
    console.log('\nüéâ Database creation completed successfully!')
    console.log('\nüìä Summary:')
    console.log(`üë• Users: ${users.length}`)
    console.log(`üè¢ Units: ${units.length}`)
    console.log(`üì¶ LTTP Items: ${lttpItems.length}`)
    console.log(`üè≠ Processing Stations: 6 types with 60 days of data each`)
    
    console.log('\nüîê Login Credentials:')
    console.log('üìß Admin: admin@military.gov.vn / admin123')
    console.log('üìß Manager: manager@military.gov.vn / admin123')
    console.log('üìß User: user@military.gov.vn / admin123')
    
    console.log('\n‚ú® Your comprehensive military logistics database is ready!')
    
  } catch (error) {
    console.error('‚ùå Fatal error during database creation:', error)
    process.exit(1)
  } finally {
    if (connected) {
      await mongoose.connection.close()
      console.log('üì¥ Database connection closed')
    }
  }
}

// Run if called directly
if (require.main === module) {
  createDatabase()
}

module.exports = { createDatabase } 